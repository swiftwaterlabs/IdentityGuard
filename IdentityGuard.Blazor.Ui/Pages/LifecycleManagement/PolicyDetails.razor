@page "/lifecycle/policy/{Id}"

<MudContainer Class="mt-16">
    <MudOverlay @bind-Visible="IsWaiting" DarkBackground="true" AutoClose="false"/>
    <Loadable IsLoading="IsLoading">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h5">@Data.Name</MudText>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        @if (IsEditing)
                        {
                            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" StartIcon="@Icons.Material.Outlined.Cancel" OnClick="Cancel" Class="ml-4">Cancel</MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Outlined.Save" OnClick="Save">Save</MudButton>
                        }
                        else
                        {
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Outlined.Edit" OnClick="Edit">Edit</MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Error" StartIcon="@Icons.Material.Outlined.Delete" OnClick="ShowDeleteDialog" Disabled="IsNew">Delete</MudButton>
                        }
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                    @if (IsEditing)
                    {
                        <MudGrid>
                            <MudItem xs="12" md="12">
                                <MudTextField @bind-Value="@Data.Name" Label="Name" Variant="Variant.Outlined" />
                            </MudItem>
                            <MudItem xs="6" md="6">
                                 <MudSelect Label="Directory" @bind-Value="@Data.DirectoryId" HelperText="String" Placeholder="Please Select"  Variant="Variant.Outlined">
                                    @foreach(var directory in AvailableDirectories)
                                    {
                                        <MudSelectItem Value="@directory.Id">@directory.Domain</MudSelectItem>
                                    }

                                </MudSelect>
                            </MudItem>
                            <MudItem  xs="6" md="6">
                                 <MudRadioGroup @bind-SelectedOption="@Data.Action">
                                    <MudRadio Option="@(IdentityGuard.Shared.Models.UserPolicyAction.Disable)">Disable</MudRadio>
                                    <MudRadio Option="@(IdentityGuard.Shared.Models.UserPolicyAction.Delete)">Delete</MudRadio>
                                </MudRadioGroup>
  
                            </MudItem>
                            <MudItem xs="12" md="12">
                                <MudTextField @bind-Value="@Data.Query" Label="Query" Placeholder="Filter criteria to identify users that the policy should be applied to" Variant="Variant.Outlined" />
                            </MudItem>
                            <MudItem xs="3" md="3">
                                <MudCheckBox @bind-Checked="@Data.Enabled" Label="Enabled" Variant="Variant.Outlined" />
                            </MudItem>
                            
                        </MudGrid>
                    }
                    else
                    {
                <MudList>
                    <MudListItem>
                        <MudText Typo="Typo.subtitle2">Directory</MudText>
                        <MudText Typo="Typo.body2">@Data.DirectoryName</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText Typo="Typo.subtitle2">Action</MudText>
                        <MudText Typo="Typo.body2">@Data.Action.ToString()</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText Typo="Typo.subtitle2">Query</MudText>
                        <MudText Typo="Typo.body2">@Data.Query</MudText>
                    </MudListItem>
                    <MudListItem>
                        <MudText Typo="Typo.subtitle2">Enabled</MudText>
                        <MudText Typo="Typo.body2">@(Data.Enabled ? "Yes": "No")</MudText>
                    </MudListItem>
                    
                </MudList>
                        
                    }
                </MudCardContent>
            </MudCard>
    </Loadable>
    
    <MudDialog @bind-IsVisible="IsDeleteDialogOpen">
        <TitleContent>
            <MudText Typo="Typo.h5"> Are you sure you would like to delete this policy?</MudText>
        </TitleContent>
        <DialogContent>
            <MudText>Once deleted, this policy will no longer be applied.</MudText>
        </DialogContent>
        <DialogActions>
             <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Cancel" Color="Color.Tertiary" OnClick="HideDeleteDialog" Class="ml-4">Cancel</MudButton>
             <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="Delete" Class="ml-4">Delete</MudButton>
        </DialogActions>
    </MudDialog>

</MudContainer>