@page  "/accessreview/{Id}"

<MudContainer Class="mt-16">
<MudOverlay @bind-Visible="IsRequesting" DarkBackground="true" AutoClose="false"/>
 <Loadable IsLoading="IsLoading">
    @if(AccessReview?.ObjectType == IdentityGuard.Shared.Models.ObjectTypes.Application)
    {
        <IdentityGuard.Blazor.Ui.Components.AccessReviews.ApplicationAccess 
            DirectoryId="@AccessReview?.DirectoryId" ApplicationId="@AccessReview?.ObjectId" AllowNewAccessReview="false" ReadOnly="@(!CanPerformActions)" OnItemRemoved="RemoveAccessReviewItem" OnItemAdded="AddAccessReviewItem" @ref="ApplicationComponent">
            <Actions>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Save" Color="Color.Primary" OnClick="ShowApplyChangesDialog" Disabled="@(!HasPendingActions())">Apply Changes</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Check" Color="Color.Success" OnClick="ShowCompleteDialog" Disabled="@(!CanPerformActions)">Complete</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="ShowAbandonDialog" Class="ml-4" Disabled="@(!CanPerformActions)">Abandon</MudButton>
            </Actions> 
        </IdentityGuard.Blazor.Ui.Components.AccessReviews.ApplicationAccess>

    }

    @if (AccessReview?.ObjectType == IdentityGuard.Shared.Models.ObjectTypes.User)
    {
        <IdentityGuard.Blazor.Ui.Components.AccessReviews.UserAccess
        DirectoryId="@AccessReview?.DirectoryId" UserId="@AccessReview?.ObjectId"  AllowNewAccessReview="false" ReadOnly="@(!CanPerformActions)" OnItemRemoved="RemoveAccessReviewItem" OnItemAdded="AddAccessReviewItem"  @ref="UserComponent">
            <Actions>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Save" Color="Color.Primary" OnClick="ShowApplyChangesDialog" Disabled="@(!HasPendingActions())">Apply Changes</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Check" Color="Color.Success" OnClick="ShowCompleteDialog" Disabled="@(!CanPerformActions)">Complete</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="ShowAbandonDialog" Class="ml-4" Disabled="@(!CanPerformActions)">Abandon</MudButton>
            </Actions>    
        </IdentityGuard.Blazor.Ui.Components.AccessReviews.UserAccess>
    }

     @if (AccessReview?.ObjectType == IdentityGuard.Shared.Models.ObjectTypes.Group)
    {
        <IdentityGuard.Blazor.Ui.Components.AccessReviews.GroupAccess
        DirectoryId="@AccessReview?.DirectoryId" GroupId="@AccessReview?.ObjectId"  AllowNewAccessReview="false" ReadOnly="@(!CanPerformActions)" OnItemRemoved="RemoveAccessReviewItem" OnItemAdded="AddAccessReviewItem"  @ref="GroupComponent">
            <Actions>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Save" Color="Color.Primary" OnClick="ShowApplyChangesDialog" Disabled="@(!HasPendingActions())">Apply Changes</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Check" Color="Color.Success" OnClick="ShowCompleteDialog" Disabled="@(!CanPerformActions)">Complete</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="ShowAbandonDialog" Class="ml-4" Disabled="@(!CanPerformActions)">Abandon</MudButton>
            </Actions>    
        </IdentityGuard.Blazor.Ui.Components.AccessReviews.GroupAccess>
    }

    <MudDialog @bind-IsVisible="IsAbandonDialogOpen">
        <TitleContent>
            <MudText Typo="Typo.h5"> Are you sure you would like to abandon this access review?</MudText>
        </TitleContent>
        <DialogContent>
            <MudText>Once abandoned, this acces review will no longer be available.</MudText>
        </DialogContent>
        <DialogActions>
             <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Cancel" Color="Color.Tertiary" OnClick="HideAbandonDialog" Class="ml-4">Cancel</MudButton>
             <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Delete" Color="Color.Error" OnClick="Abandon" Class="ml-4">Abandon</MudButton>
        </DialogActions>
    </MudDialog>

     <MudDialog @bind-IsVisible="IsCompleteDialogOpen">
        <TitleContent>
            <MudText Typo="Typo.h5"> Are you sure you would like to complete this access review?</MudText>
        </TitleContent>
        <DialogContent>
            <MudText>By completing, you are attesting that all access for the @AccessReview?.ObjectType?.ToLower() is accurate and all unecessary access has been removed.</MudText>
        </DialogContent>
        <DialogActions>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Cancel" Color="Color.Tertiary" OnClick="HideCompleteDialog" Class="ml-4">Cancel</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Check" Color="Color.Primary" OnClick="Complete" Class="ml-4">Complete</MudButton>
        </DialogActions>
    </MudDialog>

    <MudDialog @bind-IsVisible="IsApplyChangesDialogOpen">
        <TitleContent>
            <MudText Typo="Typo.h5"> Are you sure you would like to remove the specified items on the @(AccessReview.ObjectType)?</MudText>
        </TitleContent>
        <DialogContent>
            <MudText>These changes will be applied and immediately removed from @(AccessReview.DisplayName). </MudText>
        </DialogContent>
        <DialogActions>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Cancel" Color="Color.Tertiary" OnClick="HideApplyChangesDialog" Class="ml-4">Cancel</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Outlined.Check" Color="Color.Primary" OnClick="ApplyChanges" Class="ml-4">Apply Changes</MudButton>
        </DialogActions>
    </MudDialog>
</Loadable>
</MudContainer>


